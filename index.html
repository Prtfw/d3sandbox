<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>d3</title>
    <link rel="stylesheet" href="main.css">
    <!--<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>-->
    <script  type="text/javascript" src="d3.min.js"></script>
</head>
<body>
    <script>
    var w = 800
    var h = 450
    var margin = {u: 25, d:80, l:60, r:20}
    var width = w-margin.l - margin.r
    var height = h-margin.u - margin.d
    
    var data = [
	{key: "Glazed",		value: 132},
	{key: "Jelly",		value: 71},
	{key: "Holes",		value: 337},
	{key: "Sprinkles",	value: 93},
	{key: "Crumb",		value: 78},
	{key: "Chocolate",	value: 43},
	{key: "Coconut", 	value: 20},
	{key: "Cream",		value: 16},
	{key: "Cruller", 	value: 30},
	{key: "Ã‰clair", 	value: 8},
	{key: "Fritter", 	value: 17},
	{key: "Bearclaw", 	value: 21}
];
    var x = d3.scale.ordinal() //distinct values
		.domain(data.map(function(d){return d.key}))
		.rangeBands([0,width]);
    var y = d3.scale.linear()
		.domain([0,d3.max(data, function(d){return d.value})])
		.range([height,0]);
		
	/*
      var x = d3.scale.linear()
		.domain([0,d3.max(data, function(d){return d.value})])
		.range([0,width]);
    var y = d3.scale.ordinal() //distinct values
		.domain(data.map(function(d){return d.key}))
		.rangeBands([0,height]);
    
	var lincolscale = d3.scale.linear()
	                       .domain([0,data.length])
	                       .range(['#daecba','#5231dc'])
	                       */
	var ordinalcolscale = d3.scale.category20();
	
	var xAx = d3.svg.axis()
	            .scale(x)
	            .orient('bottom')
    var yAx = d3.svg.axis()
	            .scale(y)
	            .orient('left')
	            
	var yGrid = d3.svg.axis() //same as the yAx so they line up
	            .scale(y)
	            .orient('left')
	            .tickSize(-width,0,0)
	            .tickFormat("")
    var svg = d3.select('body').append('svg') //return so you can chain it
                .attr('id', 'chart') //any css/html attribute 
                .attr('width', w)
                .attr('height', h)
                
    var chart = svg.append('g') //add artificial group element svg > g > rect / text
                .classed('display', true)
                .attr('transform', 'translate('+ margin.l +','+ margin.u +')')
    var bh = 20
    
    function plot(params){
    this.append('g')  //add this first then the rest id drawn on top
        .call(yGrid)
        .classed('gridline', true)
        .attr('transform', 'translate(0,0)')
        
    this.selectAll('.bar') //bind data to class bar
        .data(params.data)
        .enter() //enter phase
            .append('rect') //creates a rect for each element of the data set
            //.attr("class", 'bar')
            .classed('bar', true)
            .classed('foo', true) //class = foo bar ; good for assigning styles
            .attr('x',function(dt,i){return x(dt.key)})
            .attr('y',function(dt,i){return y(dt.value)})
            .attr('width', function(dt,i){return x.rangeBand()})
            .attr('height', function(dt,i){ return height-y(dt.value)})
            .style('fill', function(d,i){
                //return lincolorscale(i)
                return ordinalcolscale(i)
            })
                        console.log(x.rangeBand())
            
    this.selectAll('.bar-label')
        .data(data)
        .enter()
            .append('text')
            .classed('bar-label', true)
            .attr('text-anchor', 'middle')
            .attr('x',function(dt,i){return x(dt.key)+(x.rangeBand()/2)})
            .attr('y',function(dt,i){return y(dt.value)})   
            .attr('dy',function(dt,i){return -6}) 
            .attr('dx', 0)
            .text(function(d,i){
            return d.value;
            })
    
    this.append('g')
        .classed('x Ax', true)
        .attr('transform', 'translate('+ 0 +','+ height +')') //defines the area of the chart so the axis can be oriented
        .call(xAx)
            .selectAll('text') //now working with xaxis group
                .attr('dx', -25)
                .attr('dy', 18)
                .attr('transform', 'translate(0,0) rotate(-35)')
                
     this.append('g')
        .classed('y Ax', true)
        .attr('transform', 'translate(0,0)') //defines the area of the chart so the axis can be oriented
        .call(yAx) //takes yAx as defined and insert into group
        //.style('visibility', "visible")
    
        
    this.select(".y.Ax")
        .append('text')
        .text('Units Sold')
        .attr('x',0)
        .attr('y',0)
        //.attr('dx', -10)
        .style('text-anchor', 'middle')
        .style('visibility', "visible")
        .attr('transform', 'translate(-45,'+ height/2 +') rotate(-90)')
        
    this.select(".x.Ax")
        .append('text')
        .text('Donuts!')
        .attr('x', 0)
        .attr('y', 0)
        .attr('dx', -25)
        .style('text-anchor', 'middle')
        .attr('transform', 'translate(' + (width/2)+', 75)')

    }
    
    plot.call(chart, 
    {data:data,
     ax: {
         x:xAx,
         y:yAx,
        },
    gridln: yGrid,
    
        
    }) //plot.call ('the thing that is pointed to by "this"', {params})
    
    </script>
    
</body>
</html>